{"version":3,"sources":["app\\chat\\chat.js"],"names":["Chat","props","state","user","message","friend","sessionId","btnText","getData","on","friends","filter","item","_id","length","userData","setState","removeAllListeners","session","Date","getTime","emit","currUser","newMessage","friendId","e","preventDefault","time","date","messages","newMessages","concat","chatwindow","handlePostMessage","handleLoadMessage","undefined","marginTop","paddingBottom","id","handleSwitchFriends","Component"],"mappings":"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","file":"chat.js","sourceRoot":"C:/Users/Vincent/Desktop/wemeet/client","sourcesContent":["import React from 'react';\r\nimport Navbar from '../component/navbar';\r\nimport NavBody from './navbody';\r\nimport ChatWindow from './chatwindow';\r\nimport {getUserData,getMessages,postMessage,getSessionId} from '../server';\r\nimport {socket} from '../credentials';\r\n\r\nexport default class Chat extends React.Component {\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      user: {},\r\n      message :[],\r\n      friend: \"\",\r\n      sessionId:\"\",\r\n      btnText:\"load earier messages\"\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.getData();\r\n    socket.on('online',(user)=>{\r\n      if(this.state.user.friends.filter((item) => {if(item._id===user)return true;else return false;}).length>0)\r\n      getUserData(this.props.user, (userData) => {\r\n        this.setState({\r\n          user:userData\r\n        });\r\n      });\r\n    })\r\n  }\r\n\r\n  componentWillUpdate(){\r\n    socket.removeAllListeners(\"chat\");\r\n  }\r\n\r\n  componentDidUpdate(){\r\n    socket.on('chat',()=>{\r\n      getSessionId(this.props.user,this.state.friend,(session)=>{\r\n        this.setState({\r\n          sessionId:session._id\r\n        },\r\n        ()=>{\r\n          getMessages((new Date().getTime()),this.props.user,this.state.sessionId,(message)=>{\r\n            this.setState({\r\n              message:message\r\n            },()=>{\r\n              getUserData(this.props.user, (userData) => {\r\n                this.setState({\r\n                  user:userData,\r\n                  btnText:\"load earier messages\"\r\n                });\r\n              });\r\n            })\r\n          });\r\n        })\r\n      });\r\n    });\r\n  }\r\n\r\n  getData() {\r\n    getUserData(this.props.user, (userData) => {\r\n      this.setState({\r\n        user:userData\r\n      },()=>{\r\n        this.setState({friend:this.state.user.friends[0]._id},()=>{\r\n          getSessionId(this.props.user,this.state.friend,(session)=>{\r\n            this.setState({\r\n              sessionId:session._id\r\n            },\r\n            ()=>{\r\n              getMessages((new Date().getTime()),this.props.user,this.state.sessionId,(message)=>{\r\n                this.setState({\r\n                  message:message,\r\n                  btnText:\"load earier messages\"\r\n                })\r\n              });\r\n            });\r\n          });})\r\n        })\r\n      });\r\n    }\r\n\r\n  handlePostMessage(message){\r\n    socket.emit('chat',{currUser:this.props.user,friend:this.state.friend});\r\n    postMessage(this.state.sessionId, this.props.user, this.state.friend ,message, (newMessage)=>{\r\n      this.setState({message:newMessage},()=>{\r\n        getUserData(this.props.user, (userData) => {\r\n          this.setState({\r\n            user:userData,\r\n            btnText:\"load earier messages\"\r\n          })\r\n        });\r\n      });\r\n    });\r\n  }\r\n\r\n  handleSwitchFriends(friendId){\r\n    this.setState({friend:friendId},\r\n      ()=>{\r\n        getSessionId(this.props.user,this.state.friend,(session)=>{\r\n          this.setState({\r\n            sessionId:session._id\r\n          },\r\n          ()=>{\r\n            getMessages((new Date().getTime()),this.props.user,this.state.sessionId,(message)=>{\r\n              this.setState({\r\n                message:message\r\n              },()=>{\r\n                getUserData(this.props.user, (userData) => {\r\n                  this.setState({\r\n                    user:userData,\r\n                    btnText:\"load earier messages\"\r\n                  })\r\n                })\r\n              })\r\n            });\r\n          });\r\n        });\r\n      });\r\n    }\r\n    handleLoadMessage(e){\r\n      e.preventDefault();\r\n      var time = this.state.message.length===0?(new Date().getTime()):this.state.message[0].date;\r\n      getMessages(time,this.props.user,this.state.sessionId,(messages)=>{\r\n        if(messages.length===0){\r\n          return this.setState({\r\n            btnText: \"nothing more to load\"\r\n          })\r\n        }\r\n        var newMessages = messages.concat(this.state.message);\r\n        this.setState({\r\n          message:newMessages\r\n        });\r\n      });\r\n    }\r\n\r\n    render() {\r\n      var chatwindow =\r\n      (\r\n        <ChatWindow target={this.state.friend} curUser={this.props.user}\r\n          onPost={(message)=>this.handlePostMessage(message)}\r\n          message={this.state.message}\r\n          onLoad={(e)=>this.handleLoadMessage(e)}\r\n          btnText={this.state.btnText}>\r\n        </ChatWindow>\r\n      );\r\n      if(this.state.user.friends === undefined? true: this.state.user.friends.length === 0){\r\n        chatwindow = (\r\n          <div className=\"col-md-7 col-sm-7 col-xs-7\">\r\n            <div className=\"alert alert-info\" role=\"alert\">\r\n              You don't have any chats yet\r\n            </div>\r\n          </div>)\r\n        }\r\n        return (\r\n          <div style={{marginTop:'70'}}>\r\n            <Navbar chat=\"active\" user={this.state.user}/>\r\n            <div className=\"container mainElement\">\r\n              <div className=\"row\">\r\n                <div className=\"col-md-5 col-sm-5 col-xs-5 col-md-offset-1 col-sm-offset-1 col-xs-offset-1 chat-left\">\r\n                  <div className=\"panel panel-dafault\">\r\n                    <div className=\"panel-heading panel-heading-chat\" style={{paddingBottom:\"3px\"}}>\r\n                      <ul className=\"nav nav-pills nav-justified\" >\r\n                        <li role=\"presentation\" className=\"active\">\r\n                          <a>Friends</a>\r\n                        </li>\r\n                      </ul>\r\n                    </div>\r\n                    <NavBody data={this.state.user} activeFriend={this.state.friend} switchUser={(id)=>this.handleSwitchFriends(id)}/>\r\n                  </div>\r\n                </div>\r\n                {chatwindow}\r\n              </div>\r\n\r\n            </div>\r\n\r\n          </div>\r\n        );\r\n      }\r\n    }\r\n"]}