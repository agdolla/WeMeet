{"version":3,"sources":["app\\post\\postFeedItem.js"],"names":["moment","require","debug","PostFeedItem","props","state","data","isOpen","comment","_id","currentUser","newFeedItem","setState","e","preventDefault","button","cb","likeCounter","newData","didUserLike","user","i","length","nextProps","contents","type","Error","imgs","images","img","forEach","element","index","push","src","caption","text","time","postDate","calendar","Date","getTime","fromNow","author","avatar","fullname","Object","keys","location","address_components","short_name","closeLightbox","handleLikeClick","comments","handlePostComment","map","Component"],"mappings":"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","file":"postFeedItem.js","sourceRoot":"C:/Users/Vincent/Desktop/wemeet/client","sourcesContent":["import React from 'react';\r\nimport PostComment from './postComment';\r\nimport PostCommentThread from './postCommentThread';\r\nimport {postComment} from '../server';\r\nimport {likePost} from '../server';\r\nimport {unLikePost} from '../server';\r\nimport {Link} from 'react-router';\r\nimport Lightbox from 'react-images';\r\nvar moment = require('moment');\r\nvar debug = require('react-debug');\r\n\r\nexport default class PostFeedItem extends React.Component{\r\n\r\n  constructor(props){\r\n    super(props);\r\n    this.state = {\r\n      data: props.data,\r\n      isOpen:false\r\n    };\r\n  }\r\n\r\n  handlePostComment(comment){\r\n    postComment(this.state.data._id, this.props.currentUser ,comment, (newFeedItem)=>{\r\n      this.setState({\r\n        data:newFeedItem\r\n      });\r\n    })\r\n  }\r\n\r\n  handleImgClick(e){\r\n    e.preventDefault();\r\n    this.setState({\r\n      isOpen:true\r\n    });\r\n  }\r\n  closeLightbox(e){\r\n    e.preventDefault();\r\n    this.setState({\r\n      isOpen:false\r\n    })\r\n  }\r\n\r\n  handleLikeClick(e){\r\n    e.preventDefault();\r\n\r\n    if(e.button === 0){\r\n      var cb = (likeCounter) => {\r\n        this.state.data.likeCounter = likeCounter;\r\n        var newData = this.state.data;\r\n        this.setState(\r\n          {\r\n            data:newData\r\n          }\r\n        );\r\n      };\r\n\r\n      if(!this.didUserLike(this.props.currentUser)){\r\n        likePost(this.state.data._id,this.props.currentUser,cb);\r\n      }\r\n      else{\r\n        unLikePost(this.state.data._id,this.props.currentUser,cb);\r\n      }\r\n    }\r\n  }\r\n\r\n  didUserLike(user) {\r\n    var likeCounter = this.state.data.likeCounter;\r\n\r\n    for (var i = 0; i < likeCounter.length; i++) {\r\n      if (likeCounter[i]._id === user)\r\n        return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  componentWillReceiveProps(nextProps){\r\n    this.setState({\r\n      data:nextProps.data\r\n    })\r\n  }\r\n\r\n  render(){\r\n    var data = this.state.data;\r\n    var contents;\r\n    switch(data.type){\r\n      case \"general\":\r\n        contents = data.contents;\r\n        break;\r\n      default:\r\n        throw new Error(\"Unknown FeedItem: \" + data.type);\r\n    }\r\n\r\n    var imgs = [];\r\n    var images = [];\r\n    contents.img.forEach(function(element, index) {\r\n      imgs.push(\r\n          <div style={{\"width\":\"calc(\"+(100/(this.state.img.length>2?2:this.state.img.length))+\"% - 4px)\"}}>\r\n            <img src={element} key={index} alt=\"\" style={{'width':\"100%\"}}/>\r\n          </div>\r\n        );\r\n      images.push({\r\n        src:element,\r\n        caption: contents.text\r\n      })\r\n    });\r\n\r\n    debug(imgs);\r\n\r\n    var time = moment(contents.postDate).calendar();\r\n\r\n    if((new Date().getTime()) - contents.postDate <= 86400000)\r\n      time = moment(contents.postDate).fromNow();\r\n\r\n    return(\r\n      <div className=\"panel panel-default\">\r\n        <div className=\"panel-heading\">\r\n          <div className=\"media\">\r\n            <div className=\"media-left\">\r\n              <Link to={\"profile/\"+contents.author._id}>\r\n                <img className=\"media-object\" src={contents.author.avatar} height=\"50px\" alt=\"...\"></img>\r\n              </Link>\r\n            </div>\r\n            <div className=\"media-body\">\r\n              <h4 className=\"media-heading\">{contents.author.fullname} </h4>\r\n              <span style={{\"fontSize\":\"12\"}}>{time}</span>\r\n              <div className=\"pull-right\">\r\n                <span className=\"glyphicon glyphicon-map-marker\"></span>\r\n                  {Object.keys(contents.location).length>0 ?\r\n                    (contents.location.address_components[3].short_name+\",\"+\r\n                    contents.location.address_components[5].short_name) : \"Earth\"}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div className=\"panel-body\">\r\n          <p>\r\n            {contents.text}\r\n          </p>\r\n          {\r\n            <Lightbox\r\n              images={images}\r\n              isOpen={this.state.isOpen}\r\n              onClose={(e)=>this.closeLightbox(e)}\r\n              />\r\n          }\r\n          <div className=\"postImg\">\r\n            {imgs}\r\n          </div>\r\n        </div>\r\n        <div className=\"panel-footer\">\r\n          <div className=\"row\">\r\n            <div className=\"col-md-12\">\r\n              <a href=\"#\" onClick={(e)=>this.handleLikeClick(e)}>\r\n                <span className=\"glyphicon glyphicon-heart\" \r\n                style={{\"color\":this.didUserLike(this.props.currentUser)===true?\"rgb(223, 61, 71)\":\"grey\"}}></span>\r\n                {data.likeCounter.length}\r\n              </a>\r\n              <span className=\"glyphicon glyphicon-comment\"></span>{data.comments.length}\r\n\r\n              <PostCommentThread onPostComment={(comment)=>this.handlePostComment(comment)}>\r\n                {data.comments.map((comment,i)=>{\r\n                  return (\r\n                    <PostComment key={i} data={comment} />\r\n                  )\r\n                })}\r\n              </PostCommentThread>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n"]}